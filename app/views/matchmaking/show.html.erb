<% content_for :head do %>
  <%= stylesheet_link_tag "matchmaking", "data-turbo-track": "reload" %>
<% end %>

<div class="matchmaking-container"
     data-controller="matchmaking"
     data-matchmaking-user-id-value="<%= current_user.id %>"
     data-matchmaking-matched-value="<%= @matched.to_s %>"
     data-matchmaking-game-id-value="<%= @game_id %>">
  <div class="matchmaking-background"></div>
  <div class="matchmaking-overlay"></div>

  <div class="matchmaking-content">
    
    <!-- Left: Player Card -->
    <%= render Matchmaking::PlayerCardComponent.new(
      name: current_user.name,
      title: "SEEKER OF TRUTH",
      status: :ready,
      type: :user,
      image_path: "lobby/default_avatar.jpg"
    ) %>

    <!-- Center: Animation & Status -->
    <div class="matchmaking-center">
      <div class="infinity-loader">
        <div class="infinity-loop"></div>
        <div class="infinity-glow"></div>
      </div>
      
      <div class="matchmaking-status-text" data-matchmaking-target="searchingState">
        <h2 class="status-title">探索中...</h2>
        <p class="status-subtitle">深淵の住人を探しています</p>
      </div>

      <div class="matchmaking-status-text hidden" data-matchmaking-target="matchedState">
        <h2 class="status-title">遭遇！</h2>
        <p class="status-subtitle">深淵の住人があなたを見つめている...</p>
      </div>
    </div>

    <!-- Right: Enemy Card -->
    <%= render Matchmaking::PlayerCardComponent.new(
      name: @opponent ? @opponent.name : "UNKNOWN",
      title: "CULTIST",
      status: @opponent ? :ready : :connecting,
      type: :enemy,
      image_path: @opponent ? "lobby/default_avatar.jpg" : nil
    ) %>

  </div>

  <!-- Bottom: Flavor Text -->
  <%= render Matchmaking::FlavorTextComponent.new %>

  <!-- Footer: Cancel Button -->
  <div class="matchmaking-footer">
    <%= button_to "儀式を中断する", matchmaking_path, method: :delete, class: "matchmaking-cancel-btn" %>
  </div>
</div>

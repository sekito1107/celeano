<%= stylesheet_link_tag "game_board", "data-turbo-track": "reload" %>
<%= stylesheet_link_tag "status_bar", "data-turbo-track": "reload" %>
<%= stylesheet_link_tag "card", "data-turbo-track": "reload" %>
<%= stylesheet_link_tag "animations", "data-turbo-track": "reload" %>

<div class="game-board" 
     data-controller="game--board game--animation" 
     data-game--board-game-id-value="<%= @game.id %>"
     data-game--animation-current-player-id-value="<%= @game_player&.id %>"
     data-action="click->game--board#deselectAll dragover->game--board#dragover drop->game--board#drop game--card:showDetail@window->game--board#showDetail game--card:hideDetail@window->game--board#hideDetail game--card:selectCard@window->game--board#selectCard game--board:logs-received->game--animation#playLogs">
  <div class="game-overlay"></div>
  
  <%# Animation Layer (Pointer events none, top z-index) %>
  <div id="animation-layer" class="pointer-events-none absolute inset-0 z-50"></div>
  
  <%# Master-Detail Preview Container %>
  <div id="card-preview-container" data-game--board-target="preview"></div>

  <!-- Opponent Area -->
  <div id="opponent-status" class="status-bar-wrapper opponent-status">
    <% if @opponent_game_player %>
      <%= render Game::StatusBarComponent.new(game_player: @opponent_game_player) %>
    <% end %>
  </div>

  <div class="play-mat play-mat-opponent" 
       data-action="dragover->game--board#dragover drop->game--board#drop click->game--board#playCard">
    <% if @opponent_game_player %>
      <div id="opponent-field">
        <%= render Game::FieldComponent.new(game_player: @opponent_game_player, viewer: current_user, current_turn: @current_turn) %>
      </div>
      <div id="opponent-hand">
        <%= render Game::HandComponent.new(game_player: @opponent_game_player, viewer: current_user) %>
      </div>
    <% else %>
      <div class="flex items-center justify-center h-full">
        <p class="text-xl opacity-50 font-serif">Deep within the library...</p>
      </div>
    <% end %>
  </div>

  <!-- Player Area -->
  <div id="player-status" class="status-bar-wrapper player-status">
    <%= render Game::StatusBarComponent.new(game_player: @game_player, controls: true) %>
  </div>

  <div class="play-mat">
    <div id="player-field">
      <%= render Game::FieldComponent.new(game_player: @game_player, viewer: current_user, current_turn: @current_turn) %>
    </div>
    
    <div id="reserved-spells">
      <%= render Game::ReservedSpellsComponent.new(cards: @resolving_cards) %>
    </div>

    <div id="player-hand">
      <%= render Game::HandComponent.new(game_player: @game_player, viewer: current_user) %>
    </div>
  </div>

  <!-- Game Over Overlay -->
  <% if @game.finished? %>
    <%= render Game::GameOverOverlayComponent.new(game: @game, current_user: current_user) %>
  <% else %>
    <%# Pre-render a hidden overlay component via WebSocket or logic updates later %>
    <%# Currently only server-side rendered on refresh if finished %>
  <% end %>
</div>
